name: id-pipelines

trigger:
  branches:
    include:
    - main

pool:
  name: selfhosted

parameters:
  - name: serviceConnectionName
    type: string
    default: 'id-root'

variables:
  - name: location
    value: 'swedencentral'
  - name: parameterFile
    value: 'root-identities/main.bicepparam'

stages:
- stage: id_deploy_stage
  jobs:
  - job: deploy_root_identities
    steps:
      - script: echo $(location)
      - task: AzureCLI@2
        inputs:
          azureSubscription: serviceConnectionName
          scriptType: ps
          scriptLocation: 'inlineScript' #| 'scriptPath'
          # scriptPath: 
          #arguments: 
          inlineScript: |
            az deployment tenant create \
                  --location @${{ variables.parameterFile }} \
                  --parameters @${{ variables.parameterFile }}
          powerShellErrorActionPreference: 'stop' # | 'continue' | 'silentlyContinue'
